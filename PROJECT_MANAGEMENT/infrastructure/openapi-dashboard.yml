# ARCHITEKTURA: Specyfikacja OpenAPI 3.0 dla API Panelu Dyspozytorskiego.
# Definiuje ona kontrakt "Backend for Frontend" (BFF), który dostarcza dane
# w sposób zoptymalizowany dla potrzeb aplikacji klienckiej (np. Vue.js).
# Agreguje informacje z wielu mikroserwisów (order-service, analytics-service)
# w celu uproszczenia logiki po stronie frontendu.

openapi: 3.0.3
info:
  title: "DANXILS - Dashboard API"
  description: "API dedykowane dla panelu dyspozytorskiego, dostarczające zagregowane dane o zleceniach i statusie operacyjnym."
  version: "1.0.0"
servers:
  - url: http://localhost:8080 # URL przez API Gateway
    description: Development Server

security:
  - bearerAuth: []

paths:
  /api/dashboard/summary:
    get:
      summary: "Pobiera podsumowanie kluczowych wskaźników (KPI)"
      tags: [Dashboard]
      operationId: getDashboardSummary
      responses:
        '200':
          description: "Pomyślnie pobrano podsumowanie."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardSummaryDto'
        '401':
          description: "Brak autoryzacji"

  /api/dashboard/orders/active:
    get:
      summary: "Pobiera paginowaną listę aktywnych zleceń"
      tags: [Dashboard]
      operationId: getActiveOrders
      parameters:
        - name: page
          in: query
          description: "Numer strony"
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: "Liczba elementów na stronie"
          schema:
            type: integer
            default: 20
        - name: sort
          in: query
          description: "Sortowanie (np. 'priority,desc')"
          schema:
            type: string
        - name: status
          in: query
          description: "Filtrowanie po statusie"
          schema:
            type: string
      responses:
        '200':
          description: "Lista aktywnych zleceń."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DashboardOrderListItemDto'
        '401':
          description: "Brak autoryzacji"

  /api/dashboard/map/drivers:
    get:
      summary: "Pobiera aktualne pozycje wszystkich aktywnych kierowców"
      tags: [Dashboard]
      operationId: getActiveDriversLocation
      responses:
        '200':
          description: "Lista lokalizacji aktywnych kierowców."
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ActiveDriverLocationDto'
        '401':
          description: "Brak autoryzacji"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ARCHITEKTURA: DTO dla podsumowania KPI. Agreguje dane z wielu źródeł.
    DashboardSummaryDto:
      type: object
      properties:
        newOrdersCount:
          type: integer
          description: "Liczba nowych, nieprzypisanych zleceń."
        inTransitOrdersCount:
          type: integer
          description: "Liczba zleceń aktualnie w transporcie."
        deliveredTodayCount:
          type: integer
          description: "Liczba zleceń dostarczonych dzisiaj."
        issuesCount:
          type: integer
          description: "Liczba zleceń z problemami wymagającymi interwencji."

    # ARCHITEKTURA: Uproszczone DTO dla listy zleceń. Zawiera tylko niezbędne
    # pola, co minimalizuje rozmiar payloadu i przyspiesza działanie UI.
    DashboardOrderListItemDto:
      type: object
      properties:
        orderId:
          type: string
          format: uuid
        status:
          type: string
        priority:
          type: string
        pickupCity:
          type: string
        deliveryCity:
          type: string
        assignedDriver:
          type: string
        sla:
          type: string
          format: date-time

    # ARCHITEKTURA: DTO dla widoku mapy. Dostarcza frontendowi gotowe
    # dane do wyświetlenia pozycji kierowców w czasie rzeczywistym.
    ActiveDriverLocationDto:
      type: object
      properties:
        driverId:
          type: string
        driverName:
          type: string
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double
        lastSeen:
          type: string
          format: date-time
        currentOrderId:
          type: string
          format: uuid